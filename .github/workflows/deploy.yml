name: Deploy to AI Builders

on:
  push:
    branches:
      - main
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  deploy:
    runs-on: ubuntu-latest
    name: Deploy to AI Builders Space
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Deploy to AI Builders
        env:
          AI_BUILDER_TOKEN: ${{ secrets.AI_BUILDER_TOKEN }}
        run: |
          echo "ğŸš€ å¼€å§‹éƒ¨ç½²åˆ° AI Builders..."
          
          response=$(curl -s -X POST "https://space.ai-builders.com/backend/v1/deployments" \
            -H "Authorization: Bearer ${AI_BUILDER_TOKEN}" \
            -H "Content-Type: application/json" \
            -d '{
              "repo_url": "https://github.com/${{ github.repository }}.git",
              "service_name": "ember-chat",
              "branch": "main",
              "port": 3000
            }')
          
          echo "éƒ¨ç½²å“åº”: $response"
          
          status=$(echo $response | grep -o '"status":"[^"]*"' | cut -d'"' -f4)
          url=$(echo $response | grep -o '"public_url":"[^"]*"' | cut -d'"' -f4)
          
          if [ "$status" = "queued" ] || [ "$status" = "active" ]; then
            echo "âœ… éƒ¨ç½²è¯·æ±‚å·²æäº¤ï¼"
            echo "ğŸŒ åº”ç”¨ URL: $url"
            echo "â³ è¯·ç­‰å¾… 5-10 åˆ†é’Ÿè®©éƒ¨ç½²å®Œæˆ"
          else
            echo "âŒ éƒ¨ç½²å¤±è´¥: $response"
            exit 1
          fi

      - name: Add deployment badge
        if: success()
        run: |
          echo "âœ… éƒ¨ç½²å·¥ä½œæµå·²æˆåŠŸè§¦å‘"
          echo "ğŸ“ ä½ å¯ä»¥åœ¨ GitHub ä»“åº“çš„ Actions æ ‡ç­¾é¡µæŸ¥çœ‹éƒ¨ç½²çŠ¶æ€"

